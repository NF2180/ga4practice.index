<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Checkout</title>

  <!-- GTM -->
  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TBQZ253G');
  </script>

  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TBQZ253G"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  <h1>Checkout</h1>
  <div id="summary">
    <p>Item: <span id="itemName">—</span></p>
    <p>Price: ₹<span id="itemPrice">0</span></p>
    <button id="completePurchaseBtn">Complete Purchase</button>
  </div>

  <script src="assets/js/datalayer.js"></script>
  <script>
    // read last item from sessionStorage (written by product pages)
    window.dataLayer = window.dataLayer || [];
    var last = sessionStorage.getItem('lastItem');
    var item = last ? JSON.parse(last) : null;

    if (item) {
      document.getElementById('itemName').textContent = item.item_name || item.itemName || item.item_id;
      document.getElementById('itemPrice').textContent = item.price || 0;

      // fire begin_checkout with ecommerce.items
      pushEvent('begin_checkout', {
        ecommerce: {
          items: [ item ]
        }
      });
    } else {
      // fallback: if no item, push begin_checkout without items (still useful)
      pushEvent('begin_checkout', { ecommerce: { items: [] } });
    }

    // Complete purchase
    document.getElementById('completePurchaseBtn').addEventListener('click', function(){
      var txnId = 'T-' + Date.now();
      pushEvent('purchase', {
        ecommerce: {
          transaction_id: txnId,
          value: (item && item.price) || 0,
          currency: (item && item.currency) || 'INR',
          items: item ? [ item ] : []
        }
      });

      // redirect to thank you after a short delay
      setTimeout(function(){ window.location.href = 'thank-you.html'; }, 900);
    });
  </script>
</body>
</html>
