<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout</title>

  <!-- GTM Head -->
  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TBQZ253G');
  </script>
  <!-- End GTM Head -->
</head>

<body>
  <!-- GTM Body -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TBQZ253G"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End GTM Body -->

  <h1>Checkout Page</h1>
  <p>Please confirm your purchase details below:</p>

  <div id="cartSummary">
    <p><strong>Item:</strong> <span id="itemName">Loading...</span></p>
    <p><strong>Price:</strong> â‚¹<span id="itemPrice">0</span></p>
    <button id="completePurchaseBtn">Complete Purchase</button>
  </div>

  <script>
    window.dataLayer = window.dataLayer || [];

    // Retrieve last product from sessionStorage (sent by Add to Cart)
    const item = JSON.parse(sessionStorage.getItem("lastItem")) || {
      item_name: "Unknown Item",
      item_id: "SKU-UNKNOWN",
      price: 0,
      item_category: "Unknown",
      currency: "INR"
    };

    // Populate checkout summary
    document.getElementById("itemName").textContent = item.item_name;
    document.getElementById("itemPrice").textContent = item.price;

    // Fire begin_checkout event
    window.dataLayer.push({
      event: "begin_checkout",
      ecommerce: {
        items: [item]
      }
    });

    // Complete purchase button click
    document.getElementById("completePurchaseBtn").addEventListener("click", function() {
      window.dataLayer.push({
        event: "purchase",
        ecommerce: {
          transaction_id: "T" + Date.now(),
          value: item.price,
          currency: item.currency,
          items: [item]
        }
      });

      // Redirect to Thank You page
      setTimeout(function() {
        window.location.href = "thank-you.html";
      }, 1000);
    });
  </script>
</body>
</html>
