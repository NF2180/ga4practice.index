<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Checkout</title>

  <!-- GTM -->
  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TBQZ253G');
  </script>
</head>

<body>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TBQZ253G"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  <h1>Checkout Page</h1>
  <div id="checkoutItem"></div>
  <button id="confirmPurchaseBtn">Confirm Purchase</button>

  <script src="assets/js/datalayer.js"></script>
  <script>
    // 1️⃣ Retrieve item data from localStorage
    const item = getLastItemForCheckout();

    if (item) {
      document.getElementById('checkoutItem').innerHTML = `
        <p>Item: ${item.item_name}</p>
        <p>Price: ₹${item.price}</p>
      `;

      // 2️⃣ Fire begin_checkout event
      pushEvent('begin_checkout', {
        ecommerce: {
          currency: 'INR',
          value: item.price,
          items: [item]
        }
      });
    }

    // 3️⃣ Confirm Purchase button action
    document.getElementById('confirmPurchaseBtn').addEventListener('click', function() {
      if (!item) {
        alert("No item found in checkout!");
        return;
      }

      // Fire purchase event
      pushEvent('purchase', {
        ecommerce: {
          transaction_id: 'TXN-' + Date.now(),
          currency: 'INR',
          value: item.price,
          items: [item]
        }
      });

      // Clear stored item and redirect
      clearStoredItem();

      console.log("✅ Purchase confirmed, redirecting to thank-you page...");
      setTimeout(() => {
        window.location.href = 'thank-you.html';
      }, 1000);
    });
  </script>
</body>
</html>
