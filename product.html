<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Product 1 - Red Hoodie</title>

  <!-- Google Tag Manager -->
  <script>
    (function(w,d,s,l,i){
      w[l]=w[l]||[];
      w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
      var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s), dl=l!='dataLayer'?'&l='+l:'';
      j.async=true;
      j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
      f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TBQZ253G');
  </script>
  <!-- End GTM -->

  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>

<!-- GTM (noscript) -->
<noscript>
  <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TBQZ253G"
          height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>

<header>
  <h1>Red Hoodie</h1>
  <nav>
    <a href="index.html">Home</a>
    <a href="catalog.html">Catalog</a>
    <a href="checkout.html">Checkout</a>
  </nav>
</header>

<main>
  <h2>Red Hoodie</h2>
  <p>Price: â‚¹49.99</p>
  <button id="addToCartBtn">Add to Cart</button>
</main>

<footer>
  <p>Practice site for GA4 + GTM</p>
</footer>

<!-- Load datalayer.js first -->
<script src="assets/js/datalayer.js"></script>

<script>
  // Add to Cart event listener with guaranteed firing
  const addToCartBtn = document.getElementById('addToCartBtn');

  addToCartBtn.addEventListener('click', function(e) {
    e.preventDefault(); // Prevent immediate redirect

    if (typeof pushEvent === 'function') {
      // Push add_to_cart to GTM
      pushEvent('add_to_cart', {
        id: 'SKU1',
        item_name: 'Red Hoodie',
        price: 49.99,
        quantity: 1
      });

      console.log('add_to_cart pushed');

      // Delay to ensure GTM/GA4 registers event before navigation
      setTimeout(function() {
        window.location.href = 'checkout.html';
      }, 1000); // 1 second delay

    } else {
      console.error('pushEvent not defined');
    }
  });
</script>

</body>
</html>
